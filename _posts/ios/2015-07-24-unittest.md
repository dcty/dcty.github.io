---
layout: post
title: å•å…ƒæµ‹è¯•
category: ios
keywords: å•å…ƒæµ‹è¯•
---


æ¥ç€äº”å¨ƒçš„[æ–‡ç« ](http://meiyou.im/23)ï¼Œæˆ‘è®²ä¸€ä¸‹XCTest  
å•å…ƒæµ‹è¯•çš„å¼€æºåº“è¿˜æœ‰ä¸å°‘å¤§å®¶å¯ä»¥è‡ªå·±å»[çœ‹çœ‹](http://nshipster.com/unit-testing/#open-source-libraries)  
å› ä¸ºæˆ‘ä»¬ç°åœ¨å¼€å‘çš„APPï¼Œç»å¤§éƒ¨åˆ†éƒ½éœ€éœ€è¦ç½‘ç»œäº¤äº’çš„  
æ—©æœŸçš„XCTestå¹¶ä¸æ”¯æŒå¼‚æ­¥æµ‹è¯•ï¼Œæ‰€ä»¥å¯¼è‡´å¾ˆå¤šäººéƒ½ä¸å–œæ¬¢å†™å•å…ƒæµ‹è¯•  
[è€Œç°åœ¨å·²ç»æ”¯æŒäº†](http://nshipster.com/xctestcase/)  
```objective-c
- (void)testAsynchronousURLConnection {
NSURL *URL = [NSURL URLWithString:@"http://nshipster.com/"];
NSString *description = [NSString stringWithFormat:@"GET %@", URL];
XCTestExpectation *expectation = [self expectationWithDescription:description];
NSURLSession *session = [NSURLSession sharedSession];
NSURLSessionDataTask *task = [session dataTaskWithURL:URL
completionHandler:^(NSData *data, NSURLResponse *response, NSError *error)
{
XCTAssertNotNil(data, "data should not be nil");
XCTAssertNil(error, "error should be nil");

if ([response isKindOfClass:[NSHTTPURLResponse class]]) {
NSHTTPURLResponse *httpResponse = (NSHTTPURLResponse *)response;
XCTAssertEqual(httpResponse.statusCode, 200, @"HTTP response status code should be 200");
XCTAssertEqualObjects(httpResponse.URL.absoluteString, URL.absoluteString, @"HTTP response URL should be equal to original URL");
XCTAssertEqualObjects(httpResponse.MIMEType, @"text/html", @"HTTP response content type should be text/html");
} else {
XCTFail(@"Response was not NSHTTPURLResponse");
}

[expectation fulfill];
}];

[task resume];

[self waitForExpectationsWithTimeout:task.originalRequest.timeoutInterval handler:^(NSError *error) {
if (error != nil) {
NSLog(@"Error: %@", error.localizedDescription);    
}
[task cancel];
}];
}
```

å¦‚æœéœ€è¦å¯¹æŸä¸ªæ–¹æ³•è¿›è¡Œæ€§èƒ½æµ‹è¯•çš„è¯ï¼Œå¯ä»¥ç”¨`measureBlock`è¿™ä¸œè¥¿  
åŸå…ˆæˆ‘ä»¬å¯¹ä¸€ä¸ªæ–¹æ³•è¿›è¡Œæ€§èƒ½æµ‹è¯•çš„è¯ï¼Œæ— éå°±æ˜¯è¿ç»­è·‘å‡ æ¬¡ï¼Œç„¶åå–å¹³å‡å€¼ï¼Œè€Œç°åœ¨`measureBlock `å°±æ˜¯å¹²è¿™æ´»çš„  
```objective-c
- (void)testDateFormatterPerformance {
NSDateFormatter *dateFormatter = [[NSDateFormatter alloc] init];
dateFormatter.dateStyle = NSDateFormatterLongStyle;
dateFormatter.timeStyle = NSDateFormatterShortStyle;

NSDate *date = [NSDate date];

[self measureBlock:^{
NSString *string = [dateFormatter stringFromDate:date];
}];
}
```

å¥½çš„ï¼Œä¸Šé¢çš„ä¸œè¥¿ï¼Œéƒ½æ˜¯ç½‘ç»œä¸Šèƒ½æ‰¾åˆ°çš„ï¼Œä¸‹é¢è®²è®²æˆ‘ä»¬ç”¨RACå¦‚ä½•è¿›è¡Œå•å…ƒæµ‹è¯•  
å› ä¸ºæˆ‘ä»¬RACçš„åº“é€šè¿‡podå¯¼å…¥ï¼Œæ‰€ä»¥åœ¨å†™å•å…ƒæµ‹è¯•çš„æ—¶å€™ç›´æ¥å¯¼å…¥å¤´æ–‡ä»¶çš„è¯ï¼Œä¼šæŠ¥é”™  
è§£å†³æ–¹æ¡ˆæœ‰[å¤šä¸ª](),è¿™é‡Œåªè®²æ¯”è¾ƒç®€å•çš„

platform :ios,'6.0'
link_with 'UnitTest','UnitTestTests' //é¡¾åæ€ä¹‰ï¼Œlinkåˆ°å¤šä¸ªtarget
pod 'ReactiveCocoa'

ç°åœ¨æˆ‘ä»¬å†™ä¸€ä¸ªsignalï¼Œç„¶åè·‘ä¸€ä¸‹è¯•è¯•çœ‹

[[viewModel testSignal].logAll asynchronouslyWaitUntilCompleted:NULL];
å¥½çš„ï¼Œä¸€åˆ‡æ­£å¸¸äº†ï¼Œé‚£æˆ‘ä»¬å†æ¥å†™ä¸€ä¸ªcommandè¯•ä¸€ä¸‹

[[viewModel.testCommand execute:nil].logAll asynchronouslyWaitUntilCompleted:NULL];
è¿™æ—¶å€™ä¼šå‘ç°ï¼Œé€—æ¯”äº†ï¼ŒåˆæŠ¥é”™äº†ï¼ï¼ï¼  
é€—æ¯”æ¥¼ä¸»å½“æ—¶ä¹ŸæŠ˜è…¾äº†å¾ˆä¹…ï¼Œåæ¥é‡‡ç”¨äº†ä¸€æ‹›`å°†ViewModelæ–‡ä»¶åŠ å…¥åˆ°testçš„targeté‡Œé¢å°±å¥½äº†`  
å…ˆåƒå£ğŸ’©å†·é™ä¸€ä¸‹ï¼Œä¸è¦é—®æˆ‘ä¸ºä»€ä¹ˆï¼Œæˆ‘å·²ç»å¿˜è®°åŸå› äº†ã€‚
å·®ç‚¹å¿˜è®°è¯´RACçš„ä¼˜åŠ¿äº†ã€‚
==	 
è¿™è´§æä¾›äº†ä¸¤ä¸ªæ–¹æ³•ï¼Œéƒ½æ˜¯å¼€å‘ï¼Œæˆ‘å°±ä¸è¯´äº†ï¼Œæ³¨é‡Šè‡ªå·±çœ‹å§ã€‚
```objective-c
@interface RACSignal (Testing)

/// Spins the main run loop for a short while, waiting for the receiver to send a `next`.
///
/// **Because this method executes the run loop recursively, it should only be used
/// on the main thread, and only from a unit test.**
///
/// defaultValue - Returned if the receiver completes or errors before sending
///                a `next`, or if the method times out. This argument may be
///                nil.
/// success      - If not NULL, set to whether the receiver completed
///                successfully.
/// error        - If not NULL, set to any error that occurred.
///
/// Returns the first value received, or `defaultValue` if no value is received
/// before the signal finishes or the method times out.
- (id)asynchronousFirstOrDefault:(id)defaultValue success:(BOOL *)success error:(NSError **)error;

/// Spins the main run loop for a short while, waiting for the receiver to complete.
///
/// **Because this method executes the run loop recursively, it should only be used
/// on the main thread, and only from a unit test.**
///
/// error - If not NULL, set to any error that occurs.
///
/// Returns whether the signal completed successfully before timing out. If NO,
/// `error` will be set to any error that occurred.
- (BOOL)asynchronouslyWaitUntilCompleted:(NSError **)error;

@end
```


å¯¹äº†ï¼Œä¸ºä»€ä¹ˆæˆ‘ä¼šæƒ³æŠŠæˆ‘ä»¬çš„æ¶æ„ç”±MVCå¾€MVVMä¸Šæ”¹  
å› ä¸ºViewModelæ˜¯ä¸€ä¸ªå¯å•ç‹¬æµ‹è¯•çš„ä¸œè¥¿ï¼ŒiOSçš„MVCåœ¨ViewControlleré‡Œé¢åŠ äº†å¤ªå¤šçš„ä¸œè¥¿ä¼šå¢åŠ å•å…ƒæµ‹è¯•çš„éš¾åº¦ï¼Œç”šè‡³æ˜¯ä¸å¯æµ‹è¯•ã€‚